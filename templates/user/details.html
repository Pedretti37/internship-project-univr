{% extends "base.html" %}

{% block css %}
    <link rel="stylesheet" href="/static/css/details.css">
{% endblock %}

{% block content %}
<div class="container">
    <a href="/user_home">← Back to Search</a>
    
    <h1>{{ role.title }}</h1>
    
    <div class="meta-badges">
        <span class="badge" title="Used for CEDEFOP Forecasts">ISCO ID: {{ role.id }}</span>
        <br>
        <span class="badge" title="Specific ESCO Code">Full ID: {{ role.id_full }}</span>
    </div>
    
    <div class="details-box">
        <h3>Description</h3>
        <p>{{ role.description }}</p>
        
        {% if role.uri %}
        <p style="margin-top: 15px; border-top: 1px solid #eee; padding-top: 10px;">
            <small>Official Source: 
                <a href="{{ role.uri }}" target="_blank" class="source-link">View on ESCO Portal ↗</a>
            </small>
        </p>
        {% endif %}
    </div>

    {% if role.essential_skills or role.optional_skills %}
    <div class="details-box">
        <h3>Tasks & Responsibilities</h3>
        {% if role.essential_skills %}
            <h2>Essential Skills</h2>
            <ul>
            {% for line in role.essential_skills.split('\n') %}
                {% if line.strip() %}
                    <li>{{ line }}</li>
                {% endif %}
            {% endfor %}
            </ul>
        {% endif %}
        {% if role.optional_skills %}
            <h2>Optional Skills</h2>
            <ul>
            {% for line in role.optional_skills.split('\n') %}
                {% if line.strip() %}
                    <li>{{ line }}</li>
                {% endif %}
            {% endfor %}
            </ul>
        {% endif %}
    </div>
    {% endif %}

    <hr style="width:100%; margin: 30px 0;">

    <div>
        <h2>Add This Role to Your Target Roles</h2>
        <p>Add this role to your list of target roles for future skill gap analysis.</p>
        <form action="/add_to_user_target_roles" method="post">
            <input type="hidden" name="role_id" value="{{ role.id }}">
            <input type="hidden" name="title" value="{{ role.title }}">
            <input type="hidden" name="description" value="{{ role.description }}">
            <input type="hidden" name="essential_skills" value="{{ role.essential_skills }}">
            <input type="hidden" name="optional_skills" value="{{ role.optional_skills }}">
            <input type="hidden" name="id_full" value="{{ role.id_full }}">
            <input type="hidden" name="uri" value="{{ role.uri }}">

            <button type="submit" class="btn-add-target-role">
                <span>Add to My Target Roles</span>
            </button>
        </form>
    </div>

    <div>
        {% if updated_target_role %}
            <p class="message">{{ message }}</p>
        {% endif %}
    </div>

    <hr style="width:100%; margin: 30px 0;">

    <div>
        <h2>Add the Essential Skills of this role to Your Skill Model</h2>
        <p>Select your proficiency level for this role and add it to your skill set.</p>
        <form action="/add_to_user_skills" method="post">
            <input type="hidden" name="role_id" value="{{ role.id }}">
            <input type="hidden" name="title" value="{{ role.title }}">
            <input type="hidden" name="description" value="{{ role.description }}">
            <input type="hidden" name="essential_skills" value="{{ role.essential_skills }}">
            <input type="hidden" name="optional_skills" value="{{ role.optional_skills }}">
            <input type="hidden" name="id_full" value="{{ role.id_full }}">
            <input type="hidden" name="uri" value="{{ role.uri }}">

            <label for="level">Your proficiency level (1-9):</label>
            <select name="level" id="level" required style="padding: 5px;">
                <option value="" disabled selected>Select Level...</option>
                <option value="1">1 - Beginner</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5 - Intermediate</option>
                <option value="6">6</option>
                <option value="7">7</option>
                <option value="8">8</option>
                <option value="9">9 - Expert</option>
            </select>

            <button type="submit" class="btn-add-skill">
                <span>Add to My Skills</span>
            </button>
        </form>
    </div>

    <div>
        {% if updated_skill %}
            <p class="message">{{ message }}</p>
        {% endif %}
    </div>
</div>
{% endblock %}